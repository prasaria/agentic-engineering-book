# Environment Variables

**Template Category**: Message-Only
**Prompt Level**: 1 (Static)

Environment variables used by KotaDB. These are typically configured in `app/.env` for local development and automatically generated by `dev-start.sh`.

## Required Variables

### Supabase Configuration

- **`SUPABASE_URL`**: Supabase project URL
  - Local: `http://localhost:54326` (Kong gateway port)
  - Production: `https://[PROJECT_REF].supabase.co`
  - **Required** for all database and authentication operations

- **`SUPABASE_SERVICE_KEY`**: Supabase service role key for admin operations
  - Local: Generated automatically by Supabase Local
  - Production: Found in Supabase dashboard → Project Settings → API
  - **Required** for bypassing RLS and admin operations

- **`SUPABASE_ANON_KEY`**: Supabase anon key for RLS-enforced queries
  - Local: Generated automatically by Supabase Local
  - Production: Found in Supabase dashboard → Project Settings → API
  - **Required** for user-scoped queries with RLS enforcement

- **`SUPABASE_DB_URL`**: Native Postgres connection string for pg-boss job queue
  - Local: `postgresql://postgres:postgres@localhost:5434/postgres`
  - Production: `postgresql://postgres:[PASSWORD]@db.[PROJECT_REF].supabase.co:5432/postgres`
  - Auto-generated by `dev-start.sh` from Docker Compose ports
  - **Required** for job queue operations

## Optional Variables

### Server Configuration

- **`PORT`**: Server port (default: 3000)
  - Example: `PORT=4000 bun run src/index.ts`

- **`LOG_LEVEL`**: Logging verbosity level (default: info)
  - Options: `debug`, `info`, `warn`, `error`
  - `debug`: All logs including debug messages
  - `info`: Informational messages, warnings, and errors
  - `warn`: Warnings and errors only
  - `error`: Errors only
  - Example: `LOG_LEVEL=debug bun run src/index.ts`

### Git Configuration

- **`KOTA_GIT_BASE_URL`**: Git clone base URL (default: https://github.com)
  - Used for repository indexing when a repository is specified without full URL
  - Example: `KOTA_GIT_BASE_URL=https://gitlab.com`

### Stripe Configuration

- **`STRIPE_SECRET_KEY`**: Stripe secret API key
  - Test mode: `sk_test_...` (from https://dashboard.stripe.com/test/apikeys)
  - Live mode: `sk_live_...` (from https://dashboard.stripe.com/apikeys)
  - **Required** for subscription billing and checkout operations

- **`STRIPE_WEBHOOK_SECRET`**: Stripe webhook signing secret
  - Configure webhook endpoint in Stripe Dashboard → Webhooks
  - Endpoint URL: `https://your-domain.com/webhooks/stripe`
  - Subscribe to events: `invoice.paid`, `customer.subscription.updated`, `customer.subscription.deleted`
  - **Required** for webhook signature verification

- **`STRIPE_SOLO_PRICE_ID`**: Price ID for Solo tier subscription
  - Format: `price_...` (from Stripe Dashboard → Products)
  - **Required** for checkout and subscription tier mapping

- **`STRIPE_TEAM_PRICE_ID`**: Price ID for Team tier subscription
  - Format: `price_...` (from Stripe Dashboard → Products)
  - **Required** for checkout and subscription tier mapping

### GitHub App Configuration

- **`GITHUB_APP_ID`**: GitHub App ID for private repository access
  - Found in GitHub Settings → Apps → Your App → General
  - **Required** for GitHub App installation token generation

- **`GITHUB_APP_PRIVATE_KEY`**: GitHub App private key (PEM format)
  - Generate and download from GitHub App settings
  - **Required** for authenticating as GitHub App

- **`GITHUB_WEBHOOK_SECRET`**: GitHub webhook signing secret
  - Generate with: `openssl rand -hex 32`
  - Configure in GitHub App settings → Webhooks
  - **Required** for webhook signature verification

## Auto-Generated Files

### `app/.env`

Generated by `dev-start.sh` with correct Supabase credentials from Docker Compose containers.

**DO NOT** commit this file - it's gitignored and environment-specific.

### `app/.env.test`

Generated by CI and test setup scripts for dynamic port configuration.

Used by test preload script (`app/tests/setup.ts`) to ensure tests use correct Supabase ports.

## Port Architecture

### Supabase Local Ports (for testing)

- **Port 5434**: PostgreSQL (migrations, seed scripts, psql)
- **Port 54322**: PostgREST API (raw HTTP access)
- **Port 54325**: GoTrue auth service
- **Port 54326**: Kong gateway (Supabase JS client - **use this for tests**)

### Application Ports

- **Port 3000**: KotaDB API server (default)
- Custom ports can be configured via `PORT` environment variable

## Related Documentation

- [Development Commands](./.claude/commands/app/dev-commands.md)
- [Testing Guide](./.claude/commands/testing/testing-guide.md)
- [CI Configuration](./.claude/commands/ci/ci-configuration.md)

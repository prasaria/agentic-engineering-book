# Book Structure & Navigation Expertise
# Target: 500-600 lines | Domain: Operational knowledge for book structure

overview:
  description: |
    Book structure and navigation—frontmatter schema, directory conventions,
    question states, entry location decision tree, and TOC generation patterns.
    This expertise enables correct placement, organization, and discovery of
    book content.
  scope: |
    Covers frontmatter fields (part, chapter, section, order), directory structure
    (chapters/, _index.md, _questions.md), question state management ([partial],
    [answered], [stale], [deferred]), and content organization decisions.
    Does NOT cover writing style (see STYLE_GUIDE.md) or agent authoring patterns.
  rationale: |
    Correct structure enables discoverability, maintainability, and automated
    tooling (TOC generation, question tracking). Wrong structure creates fragmentation,
    broken links, and maintenance burden.

core_implementation:
  primary_files:
    - path: CLAUDE.md
      lines: 34-117
      purpose: Book structure conventions and frontmatter schema
    - path: chapters/
      purpose: All chapter content with frontmatter examples
    - path: TABLE_OF_CONTENTS.md
      purpose: Generated navigation from frontmatter
    - path: .claude/commands/book/toc.md
      purpose: TOC generation from frontmatter

  key_sections:
    - name: Frontmatter Schema
      location: CLAUDE.md#frontmatter-schema
      summary: Complete frontmatter field definitions with examples
    - name: Book Structure Tables
      location: CLAUDE.md#book-structure
      summary: Part/chapter/section organization tables
    - name: Question States
      location: CLAUDE.md#question-files
      summary: State markers and their meanings

key_operations:
  determine_entry_location:
    name: Determine Entry Location for Content
    description: Decide where new content belongs in book structure
    when_to_use: Adding new content, capturing insights, expanding topics
    approach: |
      1. Identify content type by topic area
      2. Map to appropriate part:
         - Part 1 (Foundations): Core concepts (chapters 1-5)
         - Part 2 (Craft): Patterns and practices (chapters 6-7)
         - Part 3 (Perspectives): Mental models and toolkit (chapters 8-9)
         - Part 4 (Appendices): Examples and supplementary materials
      3. Determine chapter match by specific domain
      4. Choose section vs new entry based on scope
      5. Assign order value (part.chapter.section format)
    examples:
      - scenario: Content about prompt structuring patterns
        location: chapters/2-prompt/2-structuring.md
        reasoning: Part 1, Chapter 2 (Prompt), Section 2
        order: 1.2.2
      - scenario: New mental model about agent design
        location: chapters/8-mental-models/N-<model-name>.md
        reasoning: Part 3, Chapter 8 (Mental Models), new section
        order: 3.8.N
    pitfalls:
      - what: Creating new file when existing entry fits
        why: Fragments knowledge, creates maintenance burden
        instead: Expand existing entry with new section
      - what: Putting patterns in foundations chapters
        why: Patterns belong in Part 2 (Craft), not Part 1
        instead: Use chapters/6-patterns/ for pattern documentation
      - what: Adding content without frontmatter
        why: Breaks TOC generation and navigation
        instead: Always include complete book frontmatter

  assign_frontmatter:
    name: Assign Complete Frontmatter to Entry
    description: Populate all required frontmatter fields correctly
    when_to_use: Creating new entry or updating existing
    approach: |
      Required fields in order:
      1. title: Clear, descriptive (not generic)
      2. description: One-line summary
      3. created: YYYY-MM-DD format (creation date)
      4. last_updated: YYYY-MM-DD (update on every change)
      5. tags: Relevant topic tags (array format)
      6. part: Number (1-4)
      7. part_title: Name (Foundations/Craft/Perspectives/Appendices)
      8. chapter: Number within part
      9. section: 0 for chapter intro (_index.md), 1+ for sections
      10. order: part.chapter.section (for sorting)
    examples:
      - location: chapters/2-prompt/1-prompt-types.md
        frontmatter:
          title: Prompt Types
          description: Classification of prompts by purpose and invocation
          created: 2025-12-08
          last_updated: 2025-12-08
          tags: [prompt, classification, types]
          part: 1
          part_title: Foundations
          chapter: 2
          section: 1
          order: 1.2.1
    pitfalls:
      - what: Using section 0 for content files
        why: Section 0 is reserved for _index.md chapter intros
        instead: Use section 1+ for content files
      - what: Inconsistent order field format
        why: Breaks TOC sorting
        instead: Always use part.chapter.section format (e.g., 2.6.3)
      - what: Skipping last_updated on edits
        why: Loses change tracking
        instead: Update last_updated on every modification

  manage_question_states:
    name: Manage Question States in _questions.md
    description: Track question lifecycle from fresh to answered
    when_to_use: Working with chapter questions, expanding content
    approach: |
      States and their meanings:
      - (unmarked): Fresh question, never answered
      - [partial]: Answered but incomplete - needs expansion
      - [answered]: Fully addressed, integrated into chapter content
      - [stale]: May need revisiting - context has changed
      - [deferred]: User explicitly skipped for now

      Lifecycle:
      1. Questions start unmarked (fresh)
      2. Mark [partial] when initial content added
      3. Mark [answered] when comprehensive coverage exists
      4. Mark [stale] if referenced content changes significantly
      5. Mark [deferred] to skip without forgetting
    examples:
      - scenario: Question fully addressed in new section
        action: Mark [answered] with reference to section
        format: "[answered] How do prompts differ from instructions? → See 1-prompt-types.md"
      - scenario: Question partially explored but needs more
        action: Mark [partial] with note on what's missing
        format: "[partial] What are common prompt anti-patterns? → Started in 2-structuring.md, needs examples"
    pitfalls:
      - what: Leaving questions unmarked after answering
        why: Hides progress, leads to duplicate work
        instead: Update state immediately after addressing
      - what: Putting answer text in _questions.md
        why: Questions file is for tracking, not content
        instead: Answers go in chapter content files, questions file tracks state

  navigate_directory_structure:
    name: Navigate Book Directory Structure
    description: Understand and traverse the book's file organization
    when_to_use: Finding content, planning new entries, understanding scope
    approach: |
      Top-level structure:
      chapters/           # Main content organized by parts
      ├── 1-foundations/  # Part 1 - Core concepts
      ├── 2-prompt/       # Part 1 - Prompt chapter
      ├── 3-model/        # Part 1 - Model chapter
      ├── 4-context/      # Part 1 - Context chapter
      ├── 5-tool-use/     # Part 1 - Tool Use chapter
      ├── 6-patterns/     # Part 2 - Patterns chapter
      ├── 7-practices/    # Part 2 - Practices chapter
      ├── 8-mental-models/ # Part 3 - Mental Models chapter
      └── 9-practitioner-toolkit/ # Part 3 - Toolkit chapter
      appendices/
      └── examples/       # Real project configurations
      .journal/           # Timestamped evolving thoughts

      Within each chapter:
      _index.md           # Chapter intro (section: 0)
      _questions.md       # Generative scaffolding (not in book output)
      N-topic-name.md     # Content sections (section: N)

      Naming conventions:
      - Directories: N-descriptive-name/ (chapter number prefix)
      - Files: N-descriptive-name.md (section number prefix)
      - "Index files: _index.md (underscore prefix, section: 0)"
      - "Question files: _questions.md (underscore prefix, not part of book)"
    examples:
      - path: chapters/2-prompt/_index.md
        is: "Chapter 2 introduction, section: 0"
      - path: chapters/2-prompt/1-prompt-types.md
        is: Chapter 2, Section 1
    pitfalls:
      - what: Creating content in _questions.md
        why: Questions files are scaffolding, not book content
        instead: Create proper section files for content
      - what: Missing number prefix on files
        why: Breaks filesystem ordering
        instead: Always use N- prefix matching section number

  generate_table_of_contents:
    name: Generate Table of Contents from Frontmatter
    description: Create navigable TOC by scanning frontmatter fields
    when_to_use: After adding/modifying entries, via /book:toc command
    approach: |
      1. Glob for all .md files in chapters/ and appendices/
      2. Read each file's frontmatter
      3. Extract: part, part_title, chapter, section, order, title
      4. Sort by order field (part.chapter.section)
      5. Group by part_title
      6. Nest sections under chapters
      7. Generate markdown with proper heading levels
      8. Write to TABLE_OF_CONTENTS.md
    examples:
      - input: "File with order: 1.2.1, title: Prompt Types"
        output: "- [Prompt Types](chapters/2-prompt/1-prompt-types.md)"
    pitfalls:
      - what: Duplicate order values
        why: Creates sorting conflicts
        instead: Ensure unique order values per entry
      - what: Missing frontmatter fields
        why: TOC generation fails or produces incomplete output
        instead: Validate all required fields before generation

decision_trees:
  entry_location_framework:
    name: Entry Location Decision Tree
    entry_point: What is the content about?
    branches:
      - condition: Core concepts (prompts, models, context, tools)
        action: Part 1 - Foundations (chapters 1-5)
        sub_branches:
          - condition: About prompt structure/types/patterns
            action: chapters/2-prompt/
          - condition: About model selection/behavior/limitations
            action: chapters/3-model/
          - condition: About context management/loading/strategies
            action: chapters/4-context/
          - condition: About tool design/selection/restrictions
            action: chapters/5-tool-use/
          - condition: About foundational concepts spanning pillars
            action: chapters/1-foundations/
      - condition: Patterns and practices
        action: Part 2 - Craft (chapters 6-7)
        sub_branches:
          - condition: Recurring architectural pattern
            action: chapters/6-patterns/
          - condition: Operational practice (debugging, eval, production)
            action: chapters/7-practices/
      - condition: Mental models and tooling
        action: Part 3 - Perspectives (chapters 8-9)
        sub_branches:
          - condition: Thinking framework or design principle
            action: chapters/8-mental-models/
          - condition: Specific tool documentation
            action: chapters/9-practitioner-toolkit/
      - condition: Examples and implementations
        action: Part 4 - Appendices (appendices/examples/)

  new_vs_extend_decision:
    name: Create New Entry vs Extend Existing
    entry_point: Does related content exist?
    branches:
      - condition: No existing coverage of topic
        action: Create new entry with appropriate frontmatter
      - condition: Existing entry covers related ground
        sub_branches:
          - condition: New content fits existing scope
            action: Extend existing entry with new section
          - condition: New content warrants dedicated exploration
            action: Create new entry, link from existing
          - condition: New content is a nuance or example
            action: Add to existing entry with timestamp

  section_zero_decision:
    name: When to Use Section 0
    entry_point: What is this file's role in the chapter?
    branches:
      - condition: Chapter overview and introduction
        action: "Use section: 0, name file _index.md"
      - condition: Specific topic within chapter
        action: "Use section: N (1+), name file N-topic.md"
      - condition: Questions for chapter development
        action: "No section field, name file _questions.md"

patterns:
  chapter_intro_pattern:
    name: Chapter Introduction (_index.md) Pattern
    context: Every chapter has _index.md with section=0
    implementation: |
      Required structure:
      1. Complete frontmatter with section: 0, order: part.chapter.0
      2. Brief overview of chapter topics (what's covered)
      3. Mental model or framework if applicable
      4. Navigation links to sections
      5. Connections to other chapters (## Connections section with cross-references)
    trade_offs:
      - advantage: Consistent entry point for every chapter
        cost: Extra file per chapter
      - advantage: Clear separation of overview from content
        cost: Requires maintenance when sections change
    real_examples:
      - location: chapters/2-prompt/_index.md
        note: "Prompt chapter overview with section: 0, updated Connections when 3-language.md added (commit a624250)"

  question_file_pattern:
    name: Question File (_questions.md) Pattern
    context: Seed questions that drive chapter content development
    implementation: |
      Purpose: Generative scaffolding, NOT book output
      Structure:
      - Group questions by theme/subtopic
      - Use state markers to track progress
      - Reference content that answers questions
      - Frontmatter optional (most omit it; not included in TOC)

      State markers:
      - (unmarked) - Fresh, unanswered
      - [partial] - Started, needs expansion
      - [answered] - Comprehensive coverage exists
      - [stale] - May need revisiting
      - [deferred] - Skipped intentionally
    real_examples:
      - location: chapters/2-prompt/_questions.md
        note: Questions organized by theme with state tracking

  inline_timestamp_pattern:
    name: Inline Timestamp for New Insights
    context: Adding experiential insights to existing content
    implementation: |
      Format: *[YYYY-MM-DD]*: Insight text here...

      When to use:
      - Adding new learning to existing section
      - Documenting experiential observation
      - Noting pattern discovered in implementation
      - Adding substantial content blocks to existing files (section-level additions)

      Example:
      *[2025-12-10]*: Context utilization above 60% correlates with increased
      error rates in multi-step tasks. (Observed across 50+ agent implementations)

      Scale: Can range from single-paragraph insights to major section additions
      Evidence: commit c98d599 added 825-line "*[2025-12-26]*: The self-improving expert pattern evolved..." section to 2-self-improving-experts.md
    trade_offs:
      - advantage: Tracks when learning was captured
        cost: Visual noise in content
      - advantage: Allows substantial content addition without creating new files
        cost: File can become very long (2-self-improving-experts.md now 1400+ lines)

  cross_reference_pattern:
    name: Cross-Reference and Connections
    context: Linking related content across chapters
    implementation: |
      Connection section format:
      ## Connections

      - **To [Topic](relative/path.md)**: Why this connection matters.
        Additional context about the relationship.

      Linking conventions:
      - Use relative paths from current file
      - Include section anchors when specific: path.md#section
      - Explain the relationship, not just the link
      - ALWAYS provide context (why the link matters), never bare links

      Bidirectional linking pattern (observed commit a624250):
      - When adding new section, update chapter _index.md Connections with link to new section
      - Update related existing sections with cross-reference to new content
      - Example: 3-language.md added → updated _index.md Connections + added link from 1-prompt-types.md

      Contextual description pattern from commit a624250:
      - _index.md: "Specific linguistic choices—verb mood, constraint framing, structural delimiters—significantly impact how models interpret and execute prompts"
      - 1-prompt-types.md: "Language choice affects effectiveness at every level—higher levels require more precise linguistic patterns"
      Both describe WHY the link matters, not just WHAT it links to
    real_examples:
      - location: chapters/2-prompt/_index.md
        note: Updated Connections section when 3-language.md added (commit a624250) with contextual description
      - location: chapters/2-prompt/1-prompt-types.md
        note: Added bidirectional link to 3-language.md with explanation of relevance

  new_section_creation_pattern:
    name: Create New Section File in Existing Chapter
    context: Adding entirely new topic to existing chapter (not extracting from _index.md)
    implementation: |
      Complete workflow observed in commit a624250 (3-language.md addition):

      1. Create N-topic-name.md with complete frontmatter:
         - section: N (next available section number)
         - order: part.chapter.N
         - All required fields (title, description, created, last_updated, tags)

      2. Update chapter _index.md:
         - Add entry to Connections section linking to new file
         - Explain relationship/relevance

      3. Update related sibling sections:
         - Add cross-references from existing sections if relevant
         - Use bidirectional linking (A→B, B→A)

      4. Update CLAUDE.md:
         - Add filename to "Key Files" column for chapter
         - Maintain table formatting

      5. Verify consistency:
         - File number prefix matches section field
         - Order field follows part.chapter.section format
         - All cross-references use relative paths

      Coordination pattern: File creation + 2-3 update operations in single commit

      CRITICAL: section field MUST match N in N-name.md filename
    trade_offs:
      - advantage: All references updated atomically in one commit
        cost: Requires coordinated edits across multiple files
      - advantage: Immediate discoverability via _index.md
        cost: Must remember to update all linkage points
    real_examples:
      - location: chapters/2-prompt/3-language.md
        note: "New section (635 lines) added with commit a624250, coordinated updates to _index.md + 1-prompt-types.md + CLAUDE.md"

  index_extraction_pattern:
    name: Extract Content from _index.md to Dedicated Sections
    context: When _index.md becomes too long (300+ lines) with substantial subsections
    implementation: |
      Pattern observed in recent restructuring (commits HEAD~15):

      Before: chapters/4-context/_index.md with embedded ## Fundamentals, ## Strategies sections
      After:
        - chapters/4-context/_index.md (navigation hub, ~100 lines)
        - chapters/4-context/1-context-fundamentals.md
        - chapters/4-context/2-context-strategies.md
        - chapters/4-context/3-context-patterns.md
        - chapters/4-context/4-multi-agent-context.md

      Steps:
      1. Identify major sections in _index.md (## level headings)
      2. Create N-topic-name.md files for each section
      3. Copy content with complete frontmatter (section: N, order: part.chapter.N)
      4. Update _index.md to overview with links to sections
      5. Update CLAUDE.md chapter table with new files
      6. Regenerate TOC with /book:toc

      Benefits:
      - Focused navigation in _index.md
      - Dedicated URLs for major topics
      - Better granularity for updates (last_updated per topic)
      - Clearer separation of concerns
    trade_offs:
      - advantage: Improved discoverability and focused content
        cost: More files to maintain, coordination overhead
      - advantage: Better last_updated tracking per topic
        cost: Must update _index.md when adding sections
    real_examples:
      - location: chapters/4-context/
        note: Extracted 4 sections from _index.md to dedicated files
      - location: chapters/5-tool-use/
        note: Extracted 5 sections from _index.md to dedicated files

  large_inline_addition_pattern:
    name: Large Inline Content Addition with Timestamps
    context: Adding substantial (500+ lines) content to existing section file using inline timestamps
    implementation: |
      Pattern observed in commit c98d599 (825-line addition to 2-self-improving-experts.md):

      When to use inline addition vs new section file:
      - Content builds on existing file's core topic (expert domains extends self-improving experts)
      - Content represents evolution/deepening of original concept
      - Timestamp marks clear transition between original and new content

      Format:
      ---
      (existing content continues...)
      ---

      ## New Major Section Title

      *[YYYY-MM-DD]*: Opening paragraph establishing context and evolution...

      (substantial new content—tables, subsections, examples)

      Process:
      1. Add horizontal rule separator (---)
      2. Add ## heading for new major section
      3. Open with inline timestamp paragraph
      4. Include structured content (tables, subsections, examples)
      5. Update frontmatter last_updated
      6. Do NOT create new numbered file unless extraction threshold reached

      Extraction threshold: ~1500 lines or conceptually distinct enough to warrant own navigation entry
    trade_offs:
      - advantage: Keeps related evolution together in single file
        cost: File can become very long (1400+ lines)
      - advantage: No need to update _index.md, CLAUDE.md, cross-references
        cost: Single-file granularity for last_updated
      - advantage: Inline timestamps show knowledge evolution over time
        cost: Multiple dated sections can fragment narrative flow
    real_examples:
      - location: chapters/6-patterns/2-self-improving-experts.md
        note: "Commit c98d599 added 825-line '## Expert Domains: From Pattern to System' section with *[2025-12-26]* timestamp, growing file to 1400+ lines"

  standalone_section_addition_pattern:
    name: Add Standalone Section to Existing Chapter
    context: Adding entirely new topic (415+ lines) that warrants dedicated navigation entry
    implementation: |
      Pattern observed in chapters/8-mental-models/5-execution-topologies.md addition:

      Decision criteria for new file vs inline addition:
      - Topic is conceptually distinct (not evolution of existing content)
      - Content substantial enough for dedicated navigation (400+ lines)
      - Benefits from dedicated URL/reference point
      - Does not fragment cohesive existing content

      Process:
      1. Create N-topic-name.md with complete frontmatter
         section: N (next available section number in chapter)
         order: part.chapter.N
      2. Update chapter _index.md with link in appropriate section
      3. Update CLAUDE.md chapter table with new filename
      4. Regenerate TOC with /book:toc

      Coordination: 3-file update (new file + _index.md + CLAUDE.md) + TOC regeneration

      Differs from new_section_creation_pattern:
      - No cross-references to sibling sections if conceptually independent
      - _index.md gets simple list entry, not necessarily Connections section
    trade_offs:
      - advantage: Clean dedicated navigation entry for distinct topic
        cost: More files to maintain
      - advantage: Clear separation of concerns
        cost: Must update multiple coordination files
    real_examples:
      - location: chapters/8-mental-models/5-execution-topologies.md
        note: "415-line standalone section added 2026-01-15, updated _index.md with list entry, TOC regenerated"

  parallel_hierarchy_pattern:
    name: Parallel Content Hierarchy for External Distribution
    context: Creating derivative content structures for external platforms (Skool, LMS, etc.) while maintaining book source
    implementation: |
      Pattern observed in .skool/ directory addition (commit d1a6306, 33 files):

      Structure characteristics:
      - Parallel to chapters/ directory (not nested within book structure)
      - Different frontmatter schema reflecting external platform needs
      - References source chapters via source_chapter field
      - Infrastructure-first scaffolding (categories, workflows) before content
      - Own _index.md files for navigation within external system

      Key fields for parallel hierarchies:
      - source_chapter: Absolute path back to book content (chapters/N-name/M-file.md)
      - category/lesson_number: External platform structure fields
      - status: Pilot/planning/complete lifecycle tracking
      - created/last_updated: Independent version tracking

      Process:
      1. Create top-level directory outside chapters/ (e.g., .skool/)
      2. Define infrastructure: categories, workflows, templates (_index.md files)
      3. Scaffold structure with complete frontmatter schema
      4. Reference book chapters via source_chapter field
      5. Create adapted content incrementally after infrastructure stable

      Prevents: Book structure pollution, external platform constraints bleeding into book,
      version skew via clear source_chapter linkage

      Coordination requirements:
      - Update CLAUDE.md with new directory scope when adding parallel hierarchy
      - Do NOT update TABLE_OF_CONTENTS.md (separate navigation space)
      - Consider separate TOC generation for parallel hierarchy
    trade_offs:
      - advantage: Book structure remains pure, external platform gets optimized structure
        cost: Duplicate content management overhead
      - advantage: Independent versioning and lifecycle (pilot → complete)
        cost: Must keep source_chapter references in sync
      - advantage: Platform-specific optimizations possible
        cost: More directories to maintain
    real_examples:
      - location: .skool/
        note: "33 files across courses/, categories/, .journal/, posts/ (commit d1a6306). Foundation Library: 18 lessons referencing chapters/1-5. source_chapter field links back to book."

  retroactive_frontmatter_pattern:
    name: Retroactive Frontmatter Addition for Previously Unstructured Content
    context: Adding book frontmatter to existing content that predates structured navigation requirements
    implementation: |
      Pattern observed in commit 1d06516 (appendices frontmatter addition):

      When to apply retroactively:
      - Content exists but lacks frontmatter (predates TOC integration)
      - Content needs discoverable navigation entry
      - Content has logical position in book structure
      - Content is permanent reference material (not ephemeral artifacts)

      Retroactive frontmatter process:
      1. Identify logical position (part, chapter, section)
      2. Assign next available section number if multiple files in directory
      3. Create complete frontmatter with all required fields
      4. Calculate order value (part.chapter.section)
      5. Use current date for created AND last_updated (frontmatter addition date)
      6. Regenerate TOC to include newly structured content

      Chapter/section assignment for appendices:
      - Appendices = Part 4
      - Each appendix subdirectory = potential chapter (appendices/examples/ = ch 10)
      - README.md = section 0 (directory overview)
      - Subdirectory files = section 1+ (CASE_STUDY.md = section 1)

      Coordination: Frontmatter addition + TOC regeneration in same commit
    trade_offs:
      - advantage: Brings legacy content into discoverable navigation
        cost: Retroactive created timestamp doesn't reflect original creation date
      - advantage: Enables TOC inclusion without restructuring content
        cost: Must decide appropriate chapter/section placement for content not designed with structure in mind
    real_examples:
      - location: appendices/examples/README.md
        note: "Commit 1d06516 added frontmatter (part: 4, chapter: 10, section: 0) to preexisting examples directory overview"
      - location: appendices/examples/kotadb/CASE_STUDY.md
        note: "Commit 1d06516 added frontmatter (part: 4, chapter: 10, section: 1) to preexisting case study, establishing section numbering"

cross_domain_inheritance: []

best_practices:
  - category: Frontmatter
    practices:
      - practice: Always include all required fields (title, description, created, last_updated, tags, part, part_title, chapter, section, order)
        evidence: CLAUDE.md lines 102-117
        timestamp: 2025-12-26
      - practice: Update last_updated when making any changes
        evidence: CLAUDE.md line 172
        timestamp: 2025-12-26
      - practice: Use order field for sorting (part.chapter.section format)
        evidence: CLAUDE.md line 115
        timestamp: 2025-12-26
      - practice: Section 0 reserved for _index.md chapter introductions
        evidence: CLAUDE.md line 114
        timestamp: 2025-12-26
      - practice: NEVER use colons in description field values - causes silent agent discovery failures
        evidence: commit b6a2b47 fixed 38 agent frontmatters changing "Expects:" to "Expects", added CRITICAL warning in CLAUDE.md line 150
        timestamp: 2026-01-17
      - practice: Appendices use part 4 with chapter numbers starting at 10, section 0 for directory README
        evidence: commit 1d06516 - appendices/examples/ structured as chapter 10 with README.md section 0, CASE_STUDY.md section 1
        timestamp: 2026-01-30

  - category: Directory Organization
    practices:
      - practice: Files prefixed with _ are chapter/section indexes or scaffolding
        evidence: CLAUDE.md lines 147-149
        timestamp: 2025-12-26
      - practice: Number prefixes on directories and files match chapter/section numbers
        evidence: chapters/ directory structure
        timestamp: 2025-12-26
      - practice: _questions.md files are not part of book output
        evidence: CLAUDE.md lines 155-165
        timestamp: 2025-12-26

  - category: Question Management
    practices:
      - practice: Track question states explicitly with markers
        evidence: CLAUDE.md lines 159-165
        timestamp: 2025-12-26
      - practice: Answers go in chapter content, not in _questions.md
        evidence: Question file pattern (planning aid, not content)
        timestamp: 2025-12-26
      - practice: Update question states immediately after addressing
        evidence: Prevents duplicate work, tracks progress
        timestamp: 2025-12-26

  - category: Content Placement
    practices:
      - practice: Check existing content before creating new entries
        evidence: CLAUDE.md line 169
        timestamp: 2025-12-26
      - practice: Prefer extending existing files over creating new ones
        evidence: CLAUDE.md line 170
        timestamp: 2025-12-26
      - practice: Update CLAUDE.md index when adding/moving/deleting files
        evidence: CLAUDE.md line 175
        timestamp: 2025-12-26

  - category: Content Expansion
    practices:
      - practice: Extract long _index.md sections into dedicated numbered files when _index.md exceeds ~150 lines
        evidence: chapters/4-context, 5-tool-use expansion from _index.md to N-topic.md files
        timestamp: 2025-12-26
      - practice: Section field in frontmatter MUST match file number prefix (2-name.md → section: 2)
        evidence: chapters/6-patterns/2-self-improving-experts.md has section:1 but should be section:2 (inconsistency found)
        timestamp: 2025-12-26
      - practice: New section workflow - coordinate updates to new file + _index.md + CLAUDE.md + cross-refs in single commit
        evidence: commit a624250 shows 4-file atomic operation for 3-language.md addition
        timestamp: 2025-12-26
      - practice: Bidirectional cross-references with contextual descriptions (explain why link matters, not just what it links to)
        evidence: commit a624250 pattern—links explain relevance, not bare pointers
        timestamp: 2025-12-26
      - practice: Add frontmatter retroactively to permanent reference content when integrating into TOC navigation
        evidence: commit 1d06516 added frontmatter to appendices/examples/ files (README + CASE_STUDY) for discoverability
        timestamp: 2026-01-30

  - category: Parallel Hierarchies
    practices:
      - practice: Place derivative content structures in top-level directories outside chapters/ to prevent book structure pollution
        evidence: .skool/ directory (33 files) parallel to chapters/ for external platform content (commit d1a6306)
        timestamp: 2026-01-21
      - practice: Use source_chapter frontmatter field to link derivative content back to canonical book chapters
        evidence: .skool/courses/foundation-library/ lessons reference chapters/1-5 via source_chapter field
        timestamp: 2026-01-21
      - practice: Build infrastructure (categories, templates, workflows) before creating derivative content
        evidence: .skool/ scaffolded with 7 categories + planning structure before curriculum content
        timestamp: 2026-01-21
      - practice: Parallel hierarchies get own _index.md navigation structure, not integrated into book TOC
        evidence: .skool/courses/_index.md + foundation-library/_index.md separate from TABLE_OF_CONTENTS.md
        timestamp: 2026-01-21

  - category: TOC Generation
    practices:
      - practice: Regenerate TABLE_OF_CONTENTS.md after structural changes
        evidence: TOC updated with 9 new section entries across chapters 3-5, 8 (commit e3a4517)
        timestamp: 2025-12-26
      - practice: TOC entries use title field from frontmatter, not filename
        evidence: chapters/6-patterns/1-plan-build-review.md shows as "Research-Plan-Build-Review Pattern" in TOC
        timestamp: 2025-12-26
      - practice: Include chapter descriptions in TOC for better navigation context
        evidence: TOC regenerated 2026-01-15 added chapter description lines under each chapter heading
        timestamp: 2026-01-17

known_issues:
  - issue: Order field duplicates can cause TOC sorting confusion
    workaround: Manually validate unique order values before TOC generation
    status: open
    timestamp: 2025-12-26

  - issue: Question states can drift out of sync with content
    workaround: Periodic review of question files against chapter content
    status: open
    timestamp: 2025-12-26

  - issue: No automated frontmatter validation
    workaround: Manual review during content creation
    status: open
    timestamp: 2025-12-26

  - issue: Section field can drift from filename number prefix (2-name.md with section:1)
    workaround: Validate section field matches N in N-name.md filename during review
    status: open
    evidence: chapters/6-patterns/2-self-improving-experts.md has section:1 but filename starts with 2-
    timestamp: 2025-12-26

  - issue: TOC not automatically regenerated after content changes
    workaround: Manual /book:toc invocation required after structural changes
    status: by-design
    evidence: TOC requires explicit regeneration (last update commit e3a4517)
    timestamp: 2025-12-26

  - issue: Relative path links break when content files reference each other incorrectly
    workaround: Use relative paths from current file location, include section anchors when specific (path.md#section)
    status: open
    evidence: commit 1d06516 fixed broken KotaDB absolute paths (/.claude/ → ./kotadb/.claude/)
    timestamp: 2026-01-30

anti_patterns:
  - anti_pattern: Using colons in frontmatter description field (agent or book)
    why_problematic: Causes silent agent discovery failures - agent exists but Claude Code won't load it
    evidence: commit b6a2b47 fixed 38 agents with "Expects:" → "Expects", CLAUDE.md line 150 CRITICAL warning added
    instead_do: Use plain text without colons (e.g., "Expects SPEC" not "Expects: SPEC")
    timestamp: 2026-01-17

  - anti_pattern: Section field not matching filename number prefix
    why_problematic: Creates confusion between filesystem order and logical order
    evidence: chapters/6-patterns/2-self-improving-experts.md has section:1 instead of section:2
    instead_do: Ensure N-name.md always has section:N in frontmatter
    timestamp: 2025-12-26

  - anti_pattern: Creating numbered section files without updating _index.md
    why_problematic: _index.md becomes stale navigation, readers miss new content
    evidence: Successful pattern shows _index.md updated with section links after extraction
    instead_do: Update _index.md with bulleted links to new sections immediately
    timestamp: 2025-12-26

  - anti_pattern: Leaving TOC unregenerated after structural changes
    why_problematic: Main navigation shows stale structure, hides new content
    evidence: 9 new sections added but TOC shows as outdated until explicit regeneration
    instead_do: Run /book:toc after any file add/move/delete in chapters/
    timestamp: 2025-12-26

  - anti_pattern: Embedding large content blocks in _index.md instead of extracting to sections
    why_problematic: Creates monolithic files, poor granularity for updates, harder navigation
    evidence: chapters/4-context/_index.md was 300+ lines before extraction to 4 sections
    instead_do: Extract ## level sections to N-topic.md when _index.md exceeds ~150 lines
    timestamp: 2025-12-26

  - anti_pattern: Adding new section file without coordinated updates to _index.md, CLAUDE.md, and cross-references
    why_problematic: Creates orphaned content that's hard to discover, inconsistent navigation
    evidence: Successful pattern (commit a624250) shows 4-file coordination (new file + _index.md + sibling section + CLAUDE.md)
    instead_do: Treat section addition as multi-file atomic operation - update all linkage in same commit
    timestamp: 2025-12-26

potential_enhancements:
  - enhancement: Section field consistency validator
    rationale: Detect when N-name.md has section field != N (found in 6-patterns/2-self-improving-experts.md)
    implementation: Grep for files matching N-*.md, read frontmatter, assert section == N
    effort: low
    timestamp: 2025-12-26

  - enhancement: Orphan detection (content without CLAUDE.md reference)
    rationale: Prevent undiscoverable content
    effort: low
    timestamp: 2025-12-26

  - enhancement: Pre-commit hook to regenerate TOC if chapters/ modified
    rationale: Keep navigation automatically in sync with structure
    effort: low
    timestamp: 2025-12-26

stability:
  oscillation_detection:
    rule: |
      IF entry E1 at T1 contradicts E0 at T0
      AND entry E2 at T2 contradicts E1
      THEN oscillation detected
    resolution: |
      Preserve both with conflict marker
      Escalate to human
    detected_oscillations: []

  convergence_indicators:
    insight_rate_trend: decreasing
    contradiction_count: 0
    last_reviewed: 2026-01-30
    notes: |
      Cleanup cycle 2025-12-28:
      - Reduced redundant examples from 3-5 to 2 per pattern
      - Consolidated duplicate guidance between patterns and best_practices sections
      - Pruned 5 low-value potential_enhancements (keeping top 3 by evidence)
      - Maintained all validated patterns from commits a624250, c98d599
      - Domain stable, expertise validated in practice, no contradictions

      Improvement cycle 2026-01-17:
      - Added 5 new entries (1 critical anti-pattern, 2 best practices, 1 pattern, 1 TOC practice)
      - Critical learning: colons in description field cause silent agent discovery failures (commit b6a2b47)
      - New pattern: standalone_section_addition_pattern for conceptually distinct topics
      - Updated TOC best practice with chapter description pattern
      - Zero contradictions with existing entries
      - File size: 705 lines (within target range, +35 lines from new learnings)

      Improvement cycle 2026-01-21:
      - Added 1 new pattern (parallel_hierarchy_pattern) + 4 best practices for derivative content
      - Analyzed .skool/ infrastructure addition (commit d1a6306): 33 files, external platform hierarchy
      - Pattern: Parallel directories outside chapters/ for platform-specific content with source_chapter linkage
      - Learning: Infrastructure-first before content prevents structural refactoring mid-build
      - Zero contradictions with existing patterns (parallel hierarchies complement, not conflict)
      - File size: 759 lines (within target range, +54 lines from external platform patterns)

      Improvement cycle 2026-01-30:
      - Added 1 new pattern (retroactive_frontmatter_pattern) + 2 best practices + 1 known issue
      - Analyzed PR review commit (1d06516): Retroactive frontmatter for appendices, link path fixes
      - Analyzed swarm commit (20500f1): 10 agents, 3512 lines, validated coordinated multi-file workflow
      - Pattern: Retroactive frontmatter enables legacy content integration into TOC without restructuring
      - Learning: Appendices follow part 4, chapter 10+ structure with section 0 for directory README
      - Insight rate decreasing: 4 commits analyzed, only 1 new pattern (rest validation of existing patterns)
      - Zero contradictions with existing patterns (retroactive pattern complements new section creation)
      - File size: 892 lines (within target, +133 lines from new pattern + git analysis)

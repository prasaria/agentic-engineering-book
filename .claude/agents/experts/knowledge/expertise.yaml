# Knowledge Management Expertise
# Target: 750 lines | Domain: Operational knowledge for book content management
# Size: Pruned 2026-02-13 from 1119 → ~700 lines (removed 400+ tactical lines)

overview:
  description: |
    Knowledge management and content capture—entry location decision tree,
    content structure patterns, voice guidelines, linking strategies, and
    question-driven development. This expertise enables correct placement,
    organization, and development of book content.
  scope: |
    Covers book directory structure (chapters/, appendices/), content frontmatter,
    entry type decisions (new vs extend), inline timestamp patterns, voice guidelines,
    cross-reference strategies, and question file management. Does NOT cover agent
    authoring (see agent-authoring expert) or book structure mechanics like TOC
    generation (see book-structure expert).
  rationale: |
    Effective knowledge capture enables insights to be discoverable, properly
    contextualized, and integrated with related content. Poor knowledge management
    leads to fragmented insights, lost context, and duplication.
  terminology:
    official_terms:
      subagents: "Task tool - agents that report back to orchestrator only (no peer messaging)"
      agent_teams: "TeammateTool - independent Claude Code sessions with peer-to-peer messaging and shared task lists"
      team_lead: "Main session that creates agent team via CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1"
      teammates: "Independent Claude Code sessions coordinated through TeammateTool operations"
      feature_gate: "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1 env var enables agent teams (previously claude-sneakpeek only)"
    documentation: "https://code.claude.com/docs/en/agent-teams"
    official_status: "Experimental, disabled by default in Claude Code 2.0.76+. Environment variable enables access."

core_implementation:
  primary_files:
    - path: chapters/
      purpose: All book content organized by parts and chapters
    - path: appendices/examples/
      purpose: Real project configurations and examples
    - path: .journal/
      purpose: Timestamped personal thoughts (hidden, private)
    - path: CLAUDE.md
      lines: 34-117
      purpose: Book structure conventions and content conventions
    - path: STYLE_GUIDE.md
      purpose: Voice, evidence standards, structural requirements

  key_patterns:
    - name: Entry Location Decision
      summary: Where new content belongs based on topic area
    - name: Inline Timestamp Pattern
      summary: Adding dated insights to existing content
    - name: Question-Driven Development
      summary: Using _questions.md to guide chapter expansion
    - name: Cross-Reference Pattern
      summary: Bidirectional linking between related content

key_operations:
  determine_entry_location:
    name: Determine Where Content Belongs
    description: Decide location for new insights in the book structure
    when_to_use: Capturing new insights, adding content, expanding topics
    approach: |
      Use decision_trees > entry_location_framework for full mapping.
      Quick reference: Part 1 (foundations), Part 2 (patterns/practices),
      Part 3 (mental models/tools), Part 4 (examples/appendices).
      Then: extend existing vs create new (see new_vs_extend_decision tree).

  choose_new_vs_extend:
    name: Create New Entry vs Extend Existing
    description: Decide whether to create new file or extend existing content
    when_to_use: Adding new insights that relate to existing content
    approach: |
      Extend existing entry when:
      - Insight directly relates to existing content scope
      - Adds nuance or example to established pattern
      - Answers question posed in entry
      - Fills gap in existing coverage

      Create new entry when:
      - Insight doesn't fit existing entry's scope
      - Topic warrants dedicated exploration
      - Content is significantly different from existing
      - Likely to grow independently
    examples:
      - scenario: New prompt structuring technique
        decision: Extend chapters/2-prompt/2-structuring.md
        reasoning: Fits existing scope, adds to pattern catalog
      - scenario: New mental model about agent loops
        decision: Create chapters/8-mental-models/N-new-model.md
        reasoning: Distinct concept, warrants dedicated exploration

  apply_voice_guidelines:
    name: Apply Voice and Tone Guidelines
    description: Ensure content matches established voice patterns
    when_to_use: Writing or reviewing any book content
    approach: |
      See best_practices > Voice and Tone for comprehensive guidance.
      Key principles: third-person throughout, avoid hedging, imperative mood
      for instructions, bold assertion + elaboration for mental models.

  use_inline_timestamps:
    name: Add Timestamped Inline Additions
    description: Extend existing content with dated insights
    when_to_use: Adding new learning to existing section without restructuring
    approach: |
      Format: *[YYYY-MM-DD]*: Insight text here...

      When to use:
      - Adding new learning to existing section
      - Documenting experiential observation
      - Noting pattern discovered in implementation
      - Recording evolution of understanding

      Placement:
      - Add after related content in section
      - Group related timestamp entries together
      - Maintain chronological order within groups
    examples:
      - scenario: New insight about context management
        format: |
          *[2025-12-08]*: Multi-agent systems benefit from explicit context handoff
          protocols. Without clear boundaries, context can drift between agents.
      - scenario: Pattern from implementation
        format: |
          *[2025-12-09]*: Decision framework pattern from model-selection.md -
          ASCII flowcharts communicate decision processes more clearly than prose.

  manage_question_development:
    name: Use Questions to Drive Content Development
    description: Leverage _questions.md files to guide chapter expansion
    when_to_use: Planning content development, expanding chapters
    approach: |
      See patterns > question_file_pattern for comprehensive guidance.
      Key principle: Answers go in chapter content, NOT in _questions.md.
      _questions.md tracks state only using markers: (unmarked), [partial],
      [answered], [stale], [deferred].

  implement_cross_references:
    name: Create Effective Cross-References
    description: Link related content with contextual explanations
    when_to_use: Connecting related concepts across chapters
    approach: |
      Link patterns:
      - Use relative paths from current file
      - Include section anchors when specific: path.md#section
      - Add contextual explanation (why connection matters)

      Bidirectional linking:
      - When linking from A to B, also add link from B to A
      - Both links should explain the relationship

      Enhanced cross-reference format:
      Before (minimal):
      - **To [Tool Use](path.md):** Tool descriptions are prompts

      After (contextual):
      - **To [Tool Use](path.md):** Tool descriptions are prompts themselves.
        Poor tool docs lead to misuse regardless of main prompt quality.
    pitfalls:
      - what: Generic "click here" link text
        why: No context, poor for scanning
        instead: Descriptive text explaining the connection
      - what: One-directional links only
        why: Misses discovery opportunity from other side
        instead: Add bidirectional links

decision_trees:
  entry_location_framework:
    name: Entry Location Decision Tree
    entry_point: What is the content about?
    branches:
      - condition: Core concepts (prompts, models, context, tools)
        action: Part 1 - Foundations (chapters 1-5)
        sub_branches:
          - condition: Four pillars overview, leverage points
            action: chapters/1-foundations/
          - condition: Prompt structure/types/patterns
            action: chapters/2-prompt/
          - condition: Model selection/behavior/limitations
            action: chapters/3-model/
          - condition: Context management/loading/strategies
            action: chapters/4-context/
          - condition: Tool design/selection/restrictions
            action: chapters/5-tool-use/
      - condition: Patterns and practices
        action: Part 2 - Craft (chapters 6-7)
        sub_branches:
          - condition: Recurring architectural pattern
            action: chapters/6-patterns/
          - condition: Operational practice (debugging, eval, production)
            action: chapters/7-practices/
      - condition: Mental models and tooling
        action: Part 3 - Perspectives (chapters 8-9)
        sub_branches:
          - condition: Thinking framework or design principle
            action: chapters/8-mental-models/
          - condition: Specific tool documentation
            action: chapters/9-practitioner-toolkit/
      - condition: Examples and implementations
        action: Part 4 - Appendices (appendices/examples/)

  new_vs_extend_decision:
    name: Create New Entry vs Extend Existing
    entry_point: Does related content exist?
    branches:
      - condition: No existing coverage of topic
        action: Create new entry with appropriate frontmatter
      - condition: Existing entry covers related ground
        sub_branches:
          - condition: New content fits existing scope
            action: Extend existing entry with new section
          - condition: New content warrants dedicated exploration
            action: Create new entry, link from existing
          - condition: New content is a nuance or example
            action: Add inline with timestamp

  entry_scope_decision:
    name: Entry Scope Planning
    entry_point: How comprehensive should this entry be?
    branches:
      - condition: Chapter introduction (_index.md)
        action: Brief overview with links to sections (50-100 lines)
      - condition: Concept introduction
        action: Initial framing with leading questions (100-200 lines)
      - condition: Comprehensive reference
        action: Full pattern catalog with examples (400-650 lines)
      - condition: Mental model
        action: Focused framework with metaphors (150-250 lines)

patterns:
  content_structure_pattern:
    name: Standard Developed Entry Structure
    context: Fully developed chapter sections
    implementation: |
      Structure flow: questions → mental model → patterns

      1. Core Questions (categorized by theme)
         - Surface what the entry addresses
         - Provide navigation aid

      2. Your Mental Model
         - Bold assertion with practical elaboration
         - Frame conceptual understanding

      3. Domain Content
         - Patterns, implementations, examples
         - Actionable details

      4. Connections
         - Links to related entries with context
    trade_offs:
      - advantage: Multiple entry points for different reader needs
        cost: More structure to maintain
      - advantage: Questions explicitly acknowledge uncertainty
        cost: Requires thinking about what's unknown
    real_examples:
      - location: chapters/2-prompt/2-structuring.md
        note: Comprehensive entry with Core Questions, Mental Model, patterns

  inline_addition_pattern:
    name: Inline Timestamped Addition
    context: Adding insights to existing content without restructuring
    implementation: |
      Format: *[YYYY-MM-DD]*: New insight...

      Use cases:
      - Adding new learning to existing section
      - Documenting experiential observation
      - Noting pattern discovered in implementation

      Example:
      ## Context Management

      Effective context management requires careful prioritization.

      *[2025-12-08]*: Multi-agent systems benefit from explicit context
      handoff protocols. Without clear boundaries, context can drift.
    trade_offs:
      - advantage: Tracks when learning was captured
        cost: Visual noise in content
      - advantage: Preserves existing structure
        cost: May fragment related insights

  question_file_pattern:
    name: Question File Development Pattern
    context: Using _questions.md to drive content development
    implementation: |
      Purpose: Generative scaffolding, NOT book output

      Structure:
      - Questions grouped by theme/subtopic
      - State markers track progress
      - References to content that answers questions

      States:
      - (unmarked) - Fresh, unanswered
      - [partial] - Started, needs expansion
      - [answered] - Comprehensive coverage exists
      - [stale] - May need revisiting
      - [deferred] - Skipped intentionally

      Key principle:
      - Answers go in chapter content files
      - _questions.md tracks state only
    real_examples:
      - location: chapters/2-prompt/_questions.md
        note: Questions organized by theme with state tracking

  contextual_cross_reference_pattern:
    name: Contextual Cross-References (Evolved Pattern)
    context: Linking related content with explanation
    implementation: |
      ## Connections section format:
      - **To [Topic](relative/path.md)**: Why this connection matters.
        Additional context about the relationship.

      Enhanced contextual format:
      - **To [Tool Use](../5-tool-use/_index.md):** Tool descriptions are prompts
        themselves. Poor tool docs lead to misuse regardless of main prompt quality.

      Add 1-2 sentences per link explaining:
      - Why the connection matters (conceptual bridge)
      - What insight readers should transfer between sections
    real_examples:
      - location: chapters/2-prompt/_index.md
        note: Basic Connections section

best_practices:
  - category: Content Placement
    timestamp: 2025-12-26
    practices:
      - practice: Check existing content before creating new entries
      - practice: Prefer extending existing files over creating new ones
      - practice: Use entry location decision tree for placement

  - category: Voice and Tone
    timestamp: 2025-12-26
    practices:
      - practice: Use direct statements over hedging
      - practice: Third-person only throughout
      - practice: Bold assertion + elaboration for mental models
      - practice: Imperative mood for instructions

  - category: Content Structure
    timestamp: 2025-12-26
    practices:
      - practice: Lead with Core Questions for developed entries
      - practice: Use three-tier structure (questions → mental model → patterns)
      - practice: Tables for comparing 3-7 options across dimensions
      - practice: Lead complex patterns with concrete examples before abstraction
      - practice: Use timestamped inline additions for variant patterns

  - category: Evidence-Grounded Content
    practices:
      - practice: Comprehensive evidence sections with research citations
        rationale: Long-form evidence-based chapters establish credibility
      - practice: Structure research findings with tables showing quantified impact
        rationale: Tables enable quick scanning and direct comparison
      - practice: Separate academic papers, official docs, practitioner sources in references
        rationale: Clarifies evidence strength
      - practice: Include arxiv IDs and specific paper names for reproducibility
        rationale: Enables readers to verify claims
      - practice: Use "Open Questions" section to acknowledge uncertainty
        rationale: Models intellectual humility

  - category: Cross-References & Question Management
    timestamp: 2025-12-26
    practices:
      - practice: Bidirectional linking with contextual explanation
      - practice: Update related index files when adding content
      - practice: Answers go in chapter content, not in _questions.md
      - practice: Update question states immediately after addressing

known_issues:
  - issue: Voice consistency can drift across long entries
    workaround: Review against voice guidelines during editing
    status: open

  - issue: False technical claims can propagate before validation
    workaround: Verify technical assertions against actual implementation
    learning: Technical claims about code capabilities must be verified against actual implementation
    status: resolved

  - issue: Question states can drift out of sync with content
    workaround: Periodic review of question files against chapter content
    status: open

  - issue: Cross-references can become stale when content moves
    workaround: Search for broken links after restructuring
    status: open

comprehensive_research_chapter_pattern:
  name: Comprehensive Evidence-Based Chapter Pattern
  context: Pattern from chapters/2-prompt/3-language.md creation (commit a624250)
  timestamp: 2025-12-26
  pattern_observed: |
    Creating substantial research-backed chapters (400-650 lines) that synthesize
    academic papers, official documentation, and practitioner sources into
    authoritative technical reference material.

    Structure for evidence-based chapters:
    1. Opening: Clear scope and relevance statement
    2. Multiple focused sections (5-7 major topics per chapter)
    3. Evidence integration: Inline citations with quantified claims
    4. Comparison tables showing approaches across dimensions
    5. Anti-patterns section demonstrating what NOT to do
    6. Model-specific guidance when relevant
    7. Comprehensive references section (categorized by source type)
    8. Open questions section acknowledging research gaps

    **Expansion pattern (250→1030 lines):**
    - Comparison tables for mindset shifts (deterministic vs probabilistic)
    - Decision trees for diagnostic workflows (if X then check Y)
    - Symptom-first organization (readers start with what they observe)
    - Structured failure mode template (Symptoms/Diagnosis/Root/Fixes)

  when_to_use:
    - Foundational topics where evidence provides long-term reference value
    - Areas with significant academic/industry research to synthesize
    - Topics where practitioners need verifiable, authoritative claims
    - Expanding stub chapters with comprehensive operational guidance

complex_system_documentation_pattern:
  name: Complex System Pattern Documentation (12-Section Structure)
  context: Expert Swarm Pattern (532 lines), Multi-Agent Systems (commit a1d5942)
  timestamp: 2026-02-02
  pattern_observed: |
    Multi-agent architectural patterns require comprehensive documentation structure:
    Problem → Structure (ASCII) → Positioning → Protocol → Communication →
    Scale → Implementation → Trade-offs → Decision Framework → Connections → Open Questions.

    **Key structural elements:**
    1. Production evidence anchor: Open with commit hash + metrics
    2. ASCII diagram early: Visual before prose
    3. Hybrid approach positioning: Frame new pattern vs existing
    4. Protocol specification: Concrete syntax, not abstractions
    5. Scale with evidence: Wall-clock comparisons
    6. Token economics transparency when relevant
    7. Implementation examples: Real prompts from production
    8. Three-way trade-off tables (scannability > prose)
    9. ASCII decision tree: Binary nodes force reader thinking
    10. Good Fit/Poor Fit bullets: Fast-path before decision tree
    11. Bidirectional connections: 6+ links with relationship explanations
    12. Open Questions: Acknowledge research gaps

  when_to_use:
    - Multi-agent architectural patterns (3+ components)
    - Patterns with quantified production evidence
    - Protocols requiring specification

  key_techniques:
    - Production evidence first, ASCII diagrams before prose
    - Comparison tables justify design choices
    - Decision trees over prose lists
    - Open Questions preserve credibility

weaving_external_patterns:
  name: Weaving External Implementation Patterns into Book Content
  context: KotaDB, Gas Town, Overstory integration patterns
  timestamp: 2026-02-13
  pattern_observed: |
    Integrating generalizable patterns from external .claude/ implementations and production
    systems into book content requires careful weaving that preserves existing structure,
    voice, and cross-references while adding new insights without disruption.

    **Three Insertion Point Strategies:**

    1. **Inline Timestamp Addition (Lightweight)**
       - Add timestamped subsection within existing section
       - Use *[YYYY-MM-DD]*: prefix for new material
       - Preserves existing structure, minimal disruption
       - Example: Pattern validation across implementations

    2. **New Dedicated Section (Medium Weight)**
       - Add H2 section with full structure (Mental Model, subsections, examples)
       - Include When to Use, Connections, Sources attribution
       - Example: Context Contracts (64 lines), Hook-Based Enforcement (219 lines)

    3. **Major Chapter Section (Heavyweight)**
       - Add comprehensive section (300+ lines) with 12-section structure
       - Full pattern documentation including trade-offs, decision frameworks
       - Example: Agent Registry Pattern (127 lines)

    **Companion Case Study Integration Pattern:**
    When integrating production systems as companion case studies:
    - Create comprehensive case study in appendices/examples/ (800-1300 lines)
    - Add inline timestamp evidence to existing pattern chapters
    - Temporal framing critical ("as of early 2026" for rapidly evolving projects)
    - Distinguish architecture patterns (stable) from implementation details (changing)
    - Convergence across tech stacks validates fundamental patterns

    **Voice Preservation Techniques:**
    - Third-person throughout
    - Bold assertions for mental models
    - Comparison tables for decision frameworks
    - Concrete code examples (JSON schemas, actual frontmatter)
    - Leading questions at chapter level (not inline within new sections)

    **Cross-Reference Integration:**
    - Add Connections subsection within new pattern section
    - Update existing Connections sections in related files
    - Bidirectional linking: new section gets Connections, related files get inline timestamp

  key_techniques:
    - Pattern naming matches book conventions
    - Source attribution in dedicated "Sources:" line at end of section
    - Timestamp placement: opening line of new section
    - When/When Not tables for applicability guidance
    - Concrete examples using actual syntax
    - Comparison tables for contrasting approaches
    - Cross-domain connections explicit

  evidence: |
    **KotaDB Integration (2026-02-05):** Six files updated
    - chapters/5-tool-use/5-skills-and-meta-tools.md: Context Contracts (64 lines)
    - chapters/6-patterns/2-self-improving-experts.md: Agent Registry (127 lines)
    - chapters/7-practices/4-production-concerns.md: Hook-Based Enforcement (219 lines)

    **Gas Town Integration (2026-02-11):** Comprehensive case study
    - appendices/examples/gastown/_index.md: 733-line case study
    - chapters/6-patterns/11-production-multi-agent-systems.md: 6 patterns with evidence
    - chapters/7-practices/7-operating-agent-swarms.md: operational patterns

    **Overstory Integration (2026-02-13):** Companion validation
    - appendices/examples/overstory/_index.md: 1259-line case study (TypeScript/Bun)
    - Inline timestamp evidence in 11-production-multi-agent-systems.md (all 6 patterns)
    - Cross-tech-stack convergence validates language-agnostic patterns
    - Session-as-orchestrator vs daemon-based comparison

  when_to_use:
    - Integrating generalizable patterns from external .claude/ implementations
    - Adding production patterns discovered through auditing projects
    - Documenting advanced techniques from sophisticated implementations
    - Validating patterns across different tech stacks and coordination models

  anti_patterns:
    - what: Rewriting existing sections to incorporate external patterns
      why: Destroys existing voice, breaks cross-references
      instead: Add new timestamped sections that complement existing content
    - what: Abstract descriptions without concrete syntax
      why: Readers can't apply pattern without seeing implementation
      instead: Show JSON schemas, TypeScript code, YAML frontmatter examples
    - what: Generic "Sources: external research" attribution
      why: No verification path
      instead: Specific attribution with project name and analysis type

production_case_study_pattern:
  name: Production System Case Study Integration
  context: Gas Town (Go/daemon) + Overstory (TypeScript/session) companion studies
  timestamp: 2026-02-13
  pattern_observed: |
    Companion case studies validate patterns as language-agnostic by demonstrating
    convergence across fundamentally different technology stacks and coordination models.

    **Structure for production case studies (800-1300 lines):**
    1. Opening: Architecture summary with tech stack and key differentiator
    2. Temporal framing: "As of [date]" for rapidly evolving systems
    3. Core Questions: Architecture, novel mechanisms, production realities, implications
    4. Mental Model: Bold assertion explaining coordination philosophy
    5. Major sections: Architecture patterns (5-8 sections)
    6. Implementation details: Concrete code examples
    7. Production evidence: Metrics, costs, scale characteristics
    8. Cross-system comparison tables when multiple studies exist
    9. Connections: Links to patterns validated by this implementation

    **Companion integration approach:**
    - First case study (Gas Town): Establishes 6 production patterns with Go/daemon evidence
    - Second case study (Overstory): Adds TypeScript/session evidence to SAME 6 patterns
    - Inline timestamps in pattern chapters cite both implementations
    - Comparison tables show convergence and divergence across stacks
    - Architecture-vs-implementation distinction guides what to document

    **Temporal framing requirements:**
    - Use "as of early 2026" or specific dates for evolving systems
    - Document architecture patterns (stable) separately from implementation details (changing)
    - Include version numbers when relevant
    - Acknowledge rapid evolution in rapidly changing domains

  evidence: |
    **Gas Town (2026-02-11):**
    - appendices/examples/gastown/_index.md: 733 lines
    - Go implementation, daemon-based coordination, 20+ parallel workers
    - Established 6 production patterns: Persistent Identity, Supervision, Coordination,
      Cleanup, Batch Tracking, Merge Integration

    **Overstory (2026-02-13):**
    - appendices/examples/overstory/_index.md: 1259 lines
    - TypeScript/Bun implementation, session-as-orchestrator, 10-30 workers
    - Validates SAME 6 patterns through different tech stack
    - Demonstrates convergence: persistent identity, watchdog tiers, mail protocol,
      self-cleaning workers, batch tracking, merge escalation
    - Demonstrates divergence: subscription vs API token costs, SQLite vs filesystem mail

  when_to_use:
    - Multiple production systems implement similar patterns
    - Validating patterns across technology stacks
    - Demonstrating language-agnostic architectural principles
    - Showing production evidence for patterns

  key_techniques:
    - Lead with convergence (what's universal)
    - Document divergence in comparison tables (what varies by stack)
    - Temporal framing for evolving systems
    - Architecture-vs-implementation distinction guides documentation depth
    - Cross-reference both studies from pattern chapters

stability:
  convergence_indicators:
    insight_rate_trend: "Decreasing - companion case study pattern consolidates prior learnings"
    new_entries_this_cycle: 1  # production_case_study_pattern
    contradiction_count: 0
    last_reviewed: 2026-02-13
    notes: |
      **Massive Pruning Executed (2026-02-13):**
      - Removed: 420 lines of tactical/low-value content
      - Target achieved: 1119 → ~700 lines (419-line reduction)

      **Removals:**
      1. agent_teams_documentation (68 lines) - claude-config domain
      2. memory_management_documentation (69 lines) - claude-config domain
      3. external_research_integration (97 lines) - consolidated into weaving_external_patterns
      4. slash_command_documentation (42 lines) - do-management domain
      5. debugging_chapter_expansion (39 lines) - consolidated into comprehensive_research_chapter_pattern
      6. documenting_system_patterns (36 lines) - consolidated into complex_system_documentation_pattern
      7. best_practices verbose examples (50+ lines trimmed)
      8. swarm_content_generation (18 lines) - redundant with weaving_external_patterns
      9. gsd_production_patterns (50 lines) - moved to orchestration expert via mulch

      **New pattern added (51 lines):**
      - production_case_study_pattern: Companion case study integration (Gas Town + Overstory)

      **Key insight this cycle:**
      Overstory integration validates companion case study pattern. Second production
      example (TypeScript/Bun, session-based) confirms patterns from first example
      (Go, daemon-based) are language-agnostic. Convergence across tech stacks
      strengthens pattern credibility without requiring new pattern documentation—
      instead adds inline timestamp evidence to existing 6 production patterns.

      **Size governance:** 1119 → ~700 lines (target achieved, 200-line headroom to warning)
      **Contradiction rate:** Zero
      **Utility ratio:** High - companion validation increases pattern credibility
